define(["jquery","core/ajax","core/notification"],function(a,b,c){return{init:function(d,e){var f=e.courseid,g=e.contextid,h=b.call([{methodname:"block_point_view_get_section_range",args:{sectionid:d},fail:c.exception},{methodname:"block_point_view_get_course_data",args:{courseid:f,contextid:g},fail:c.exception},{methodname:"block_point_view_get_track_colors",args:{},fail:c.exception}]);a.when(h[0],h[1],h[2]).done(function(d,e,g){function h(){p.forEach(function(b){var c=a("."+b+":checkbox:checked").length;c===a("."+b+":checkbox").length?(a("#id_enableall"+b).addClass("active"),a("#id_disableall"+b).removeClass("active")):0===c?(a("#id_disableall"+b).addClass("active"),a("#id_enableall"+b).removeClass("active")):(a("#id_enableall"+b).removeClass("active"),a("#id_disableall"+b).removeClass("active"))})}function i(){o.forEach(function(b){var c=a(".checkboxgroup"+b+":checkbox:checked").length;c===a(".checkboxgroup"+b+":checkbox").length?(a("#id_enable_"+b).addClass("active"),a("#id_disable_"+b).removeClass("active")):0===c?(a("#id_disable_"+b).addClass("active"),a("#id_enable_"+b).removeClass("active")):(a("#id_disable_"+b).removeClass("active"),a("#id_enable_"+b).removeClass("active"))})}function j(b){a(".check_section_"+b.data.id).prop("checked",!0),a(this).addClass("active"),a("#id_disable_"+b.data.id).removeClass("active"),h()}function k(b){a(".check_section_"+b.data.id).prop("checked",!1),a(this).addClass("active"),a("#id_enable_"+b.data.id).removeClass("active"),h()}function l(b){a(this).is(":checked")?(a("#id_disable_"+b.data.id).removeClass("active"),a("#id_disableall"+b.data.type).removeClass("active")):(a("#id_enable_"+b.data.id).removeClass("active"),a("#id_enableall"+b.data.type).removeClass("active"));var c=a(".checkboxgroup"+b.data.id+":checkbox:checked").length;c===a(".checkboxgroup"+b.data.id+":checkbox").length?a("#id_enable_"+b.data.id).addClass("active"):0===c&&a("#id_disable_"+b.data.id).addClass("active");var d=a("."+b.data.type+":checkbox:checked").length;d===a("."+b.data.type+":checkbox").length?a("#id_enableall"+b.data.type).addClass("active"):0===d&&a("#id_disableall"+b.data.type).addClass("active")}function m(a){var b;if(b=void 0!==this.value?parseInt(this.value):a.data.value,0!==b){var c;switch(b){case 1:c=r.greentrack;break;case 2:c=r.bluetrack;break;case 3:c=r.redtrack;break;case 4:c=r.blacktrack}a.data.module.css({"background-color":c,color:"white"})}else a.data.module.css({"background-color":"",color:""})}function n(){a("#id_config_enable_point_views_checkbox").is(":checked")||a("#id_config_enable_difficulties_checkbox").is(":checked")?a("#id_activities").css({display:""}):a("#id_activities").css({display:"none"}),a("#id_config_enable_difficulties_checkbox").is(":checked")?q.forEach(function(b){a("#id_config_difficulty_"+b).css({display:""})}):q.forEach(function(b){a("#id_config_difficulty_"+b).css({display:"none"})}),a("#id_config_enable_point_views_checkbox").is(":checked")?(a("#id_config_images").css({display:""}),q.forEach(function(b){a("#id_config_moduleselectm"+b).css({display:""})}),p.forEach(function(b){a('div[data-groupname="'+b+'_group_type"]').css({display:""})}),o.forEach(function(b){a("#id_enable_"+b).css({display:""}),a("#id_disable_"+b).css({display:""})})):(a("#id_config_images").css({display:"none"}),q.forEach(function(b){a("#id_config_moduleselectm"+b).css({display:"none"})}),p.forEach(function(b){a('div[data-groupname="'+b+'_group_type"]').css({display:"none"})}),o.forEach(function(b){a("#id_enable_"+b).css({display:"none"}),a("#id_disable_"+b).css({display:"none"})}))}var o=d,p=e.types,q=e.ids,r=g;a("#id_go_to_save").click(function(){window.onbeforeunload=null,a("#mform1").submit()}).removeClass("btn-secondary").addClass("btn-primary"),a("#id_close_field").click(function(){a("#id_activities").addClass("collapsed"),window.location="#maincontent"}),q.forEach(function(b){var c=a("#id_config_moduleselectm"+b).attr("class");if(void 0!==c){var d=c.split(" "),e=null,f=null;d.forEach(function(a){p.indexOf(a)!==-1&&(e=p[p.indexOf(a)]),a.search("check_section_")!==-1&&(f=a.match(/\d+/))}),a("#id_config_moduleselectm"+b).click({id:f,type:e},l)}var g=parseInt(a("#id_config_difficulty_"+b+" :selected").val()),h=a("#id_config_difficulty_"+b);m({data:{value:g,module:h}}),h.change({module:h},m)}),o.forEach(function(b){a("#id_enable_"+b).click({id:b},j).removeClass("btn-secondary").addClass("btn-outline-success"),a("#id_disable_"+b).click({id:b},k).removeClass("btn-secondary").addClass("btn-outline-danger"),a('div[data-groupname="manage_checkbox_'+b+'"] .pull-xs-right').css({"padding-top":"20px"}),a('div[data-groupname="manage_checkbox_'+b+'"] .float-sm-right').css({"padding-top":"20px"})}),i(),p.forEach(function(b){a("#id_enableall"+b).click(function(){a("input."+b).prop("checked",!0),a(this).addClass("active"),a("#id_disableall"+b).removeClass("active"),i()}).removeClass("btn-secondary").addClass("btn-outline-success"),a("#id_disableall"+b).click(function(){a("input."+b).prop("checked",!1),a(this).addClass("active"),a("#id_enableall"+b).removeClass("active"),i()}).removeClass("btn-secondary").addClass("btn-outline-danger"),h()}),a("#id_config_reset_pix").removeClass("btn-secondary").addClass("btn-outline-warning").click(function(){a("#id_config_enable_pix_checkbox:checked").prop("checked",!1),a("#mform1").submit()}),n(),a("#id_config_enable_point_views_checkbox").click(n),a("#id_config_enable_difficulties_checkbox").click(n),a('div[data-groupname="config_reset_confirm"]').css({display:"none"}),a("#id_config_reset_yes").removeClass("btn-secondary").addClass("btn-success").click(function(){b.call([{methodname:"block_point_view_update_db",args:{func:"reset",userid:null,courseid:f,cmid:null,vote:null},done:function(){a("#mform1").submit()},fail:c.exception}])}),a("#id_config_reset_no").removeClass("btn-secondary").addClass("btn-danger").click(function(){a('div[data-groupname="config_reset_confirm"]').css({display:"none"})}),a("#id_config_reaction_reset_button").removeClass("btn-secondary").addClass("btn-outline-warning").click(function(){a('div[data-groupname="config_reset_confirm"]').css({display:""})})})}}});