define(["jquery","core/ajax","core/notification"],function(a,b,c){return{init:function(d){a(function(){a(".mod-indent-outer").css({width:"85%"});var e=parseInt(d.userid),f=d.courseid,g=d.contextid,h=b.call([{methodname:"block_point_view_get_database",args:{userid:e,courseid:f},fail:c.exception},{methodname:"block_point_view_get_pixparam",args:{courseid:f,contextid:g},fail:c.exception},{methodname:"block_point_view_get_moduleselect",args:{courseid:f},fail:c.exception},{methodname:"block_point_view_get_difficulty_levels",args:{courseid:f},fail:c.exception},{methodname:"block_point_view_get_track_colors",args:{},fail:c.exception}]);a.when(h[0],h[1],h[2],h[3],h[4]).done(function(d,g,h,i,j){function k(b,c){var d=parseInt(b.getElementsByClassName("easy_nb")[0].innerText),e=parseInt(b.getElementsByClassName("better_nb")[0].innerText),f=parseInt(b.getElementsByClassName("hard_nb")[0].innerText),g="group_";if(d&&(g+="E"),e&&(g+="B"),f&&(g+="H"),A[c]!==y.NULL){var h=a("#module-"+c+" .group_nb");h.addClass("voted"),B[c]>=10&&h.css({"font-size":"10px"})}else a("#module-"+c+" .group_nb").removeClass("voted");a("#module-"+c+" .group_img").attr("src",u[g])}function l(a){var b,c=!1;return t.forEach(function(d){parseInt(d.cmid)===a&&(b=d,c=!0)}),c||(b={cmid:a.toString(),courseid:f,total:"0",typeone:"0",typetwo:"0",typethree:"0",uservote:"0"}),b}function m(b){a(this).stop(),a(this).css({cursor:"pointer"}),a(this).animate({top:-1.5,left:-3,height:23},100),D[b.data.moduleId]=setTimeout(function(){0===parseInt(b.data.module.getElementsByClassName("easy_nb")[0].innerText)&&a("#module-"+b.data.moduleId+" .easy").css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"}),0===parseInt(b.data.module.getElementsByClassName("better_nb")[0].innerText)&&a("#module-"+b.data.moduleId+" .better").css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"}),0===parseInt(b.data.module.getElementsByClassName("hard_nb")[0].innerText)&&a("#module-"+b.data.moduleId+" .hard").css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"}),a("#module-"+b.data.moduleId+" .group_img").animate({top:"+=15",left:"+=35",height:0},300).hide(0),a("#module-"+b.data.moduleId+" .group_nb").delay(50).hide(300),a("#module-"+b.data.moduleId+" .actions").hide(300),a("#module-"+b.data.moduleId+" .easy").delay(50).animate({top:-15,left:-20,height:20},300).css({"pointer-events":"auto"}),a("#module-"+b.data.moduleId+" .easy_nb").delay(50).show(300),a("#module-"+b.data.moduleId+" .better").delay(200).animate({top:-15,left:25,height:20},300).css({"pointer-events":"auto"}),a("#module-"+b.data.moduleId+" .better_nb").delay(200).show(300),a("#module-"+b.data.moduleId+" .hard").delay(400).animate({top:-15,left:70,height:20},300).css({"pointer-events":"auto"}),a("#module-"+b.data.moduleId+" .hard_nb").delay(400).show(300)},500),clearTimeout(C[b.data.moduleId]),C[b.data.moduleId]=setTimeout(function(){z[b.data.moduleId]||(a("#module-"+b.data.moduleId+" .hard").css({"pointer-events":"none"}).delay(50).animate({top:-7.5,left:80,height:0},500),a("#module-"+b.data.moduleId+" .hard_nb").delay(50).hide(300),a("#module-"+b.data.moduleId+" .better").css({"pointer-events":"none"}).delay(300).animate({top:-7.5,left:35,height:0},500),a("#module-"+b.data.moduleId+" .better_nb").delay(300).hide(300),a("#module-"+b.data.moduleId+" .easy").css({"pointer-events":"none"}).delay(600).animate({top:-7.5,left:-10,height:0},500),a("#module-"+b.data.moduleId+" .easy_nb").delay(600).hide(300),k(b.data.module,b.data.moduleId),a("#module-"+b.data.moduleId+" .group_img").show(0).delay(500).animate({top:0,left:0,height:20},300),0!==parseInt(b.data.module.getElementsByClassName("group_nb")[0].innerText)&&a("#module-"+b.data.moduleId+" .group_nb").delay(600).show(300),a("#module-"+b.data.moduleId+" .actions").delay(600).show(300))},2e3)}function n(b){a(this).stop(),clearTimeout(D[b.data.moduleId]),"0px"===a("#module-"+b.data.moduleId+" .easy").css("height")&&a(this).animate({top:0,left:0,height:20},100)}function o(b){a(this).stop();var c=a("#module-"+b.data.moduleId+" ."+b.data.reactionName+"_txt").width();a("#module-"+b.data.moduleId+" ."+b.data.reactionName+"_txt").css({left:b.data.leftReaction+10-c/2+70});var d=parseInt(b.data.module.getElementsByClassName(b.data.reactionName+"_nb")[0].innerText);0===d&&a("#module-"+b.data.moduleId+" ."+b.data.reactionName).css({"-webkit-filter":"",filter:""}),a(this).css({cursor:"pointer"}),a(this).animate({top:-25,left:b.data.leftReaction,height:40},100)}function p(b){a(this).stop(),a(this).animate({top:-15,left:b.data.leftReaction,height:20},100);var c=parseInt(b.data.module.getElementsByClassName(b.data.reactionName+"_nb")[0].innerText);0===c&&a("#module-"+b.data.moduleId+" ."+b.data.reactionName).css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"})}function q(d){if(null!==e&&1!==e){var g=parseInt(d.data.module.getElementsByClassName(d.data.reactionName+"_nb")[0].innerText);B[d.data.moduleId]=parseInt(d.data.module.getElementsByClassName("group_nb")[0].innerText),0===g&&a("#module-"+d.data.moduleId+" ."+d.data.reactionName).css({"-webkit-filter":"",filter:""}),A[d.data.moduleId]===y.NULL?b.call([{methodname:"block_point_view_update_db",args:{func:"insert",userid:e,courseid:f,cmid:d.data.moduleId,vote:d.data.reactionSelect},done:function(){d.data.module.getElementsByClassName(d.data.reactionName+"_nb")[0].innerText=g+1,a("#module-"+d.data.moduleId+" ."+d.data.reactionName+"_nb").css({"font-weight":"bold",color:"#5585B6"}),d.data.module.getElementsByClassName("group_nb")[0].innerText=B[d.data.moduleId]+1,A[d.data.moduleId]=d.data.reactionSelect},fail:c.exception}]):A[d.data.moduleId]===d.data.reactionSelect?b.call([{methodname:"block_point_view_update_db",args:{func:"remove",userid:e,courseid:f,cmid:d.data.moduleId,vote:d.data.reactionSelect},done:function(){g--,d.data.module.getElementsByClassName(d.data.reactionName+"_nb")[0].innerText=g,a("#module-"+d.data.moduleId+" ."+d.data.reactionName+"_nb").css({"font-weight":"normal",color:"black"}),0===g&&a("#module-"+d.data.moduleId+" ."+d.data.reactionName).css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"}),d.data.module.getElementsByClassName("group_nb")[0].innerText=B[d.data.moduleId]-1,A[d.data.moduleId]=y.NULL},fail:c.exception}]):b.call([{methodname:"block_point_view_update_db",args:{func:"update",userid:e,courseid:f,cmid:d.data.moduleId,vote:d.data.reactionSelect},done:function(){d.data.module.getElementsByClassName(d.data.reactionName+"_nb")[0].innerText=g+1,a("#module-"+d.data.moduleId+" ."+d.data.reactionName+"_nb").css({"font-weight":"bold",color:"#5585B6"});var b;switch(A[d.data.moduleId]){case y.EASY:b="easy";break;case y.BETTER:b="better";break;case y.HARD:b="hard"}var c=parseInt(d.data.module.getElementsByClassName(b+"_nb")[0].innerText)-1;d.data.module.getElementsByClassName(b+"_nb")[0].innerText=c,a("#module-"+d.data.moduleId+" ."+b+"_nb").css({"font-weight":"normal",color:"black"}),0===c&&a("#module-"+d.data.moduleId+" ."+b).css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"}),A[d.data.moduleId]=d.data.reactionSelect},fail:c.exception}])}}function r(a){z[a.data.moduleId]=!0}function s(b){z[b.data.moduleId]=!1,clearTimeout(C[b.data.moduleId]),C[b.data.moduleId]=setTimeout(function(){z[b.data.moduleId]||(a("#module-"+b.data.moduleId+" .hard").css({"pointer-events":"none"}).delay(50).animate({top:-7.5,left:80,height:0},500),a("#module-"+b.data.moduleId+" .hard_nb").delay(50).hide(300),a("#module-"+b.data.moduleId+" .better").css({"pointer-events":"none"}).delay(300).animate({top:-7.5,left:35,height:0},500),a("#module-"+b.data.moduleId+" .better_nb").delay(300).hide(300),a("#module-"+b.data.moduleId+" .easy").css({"pointer-events":"none"}).delay(600).animate({top:-7.5,left:-10,height:0},500),a("#module-"+b.data.moduleId+" .easy_nb").delay(600).hide(300),k(b.data.module,b.data.moduleId),a("#module-"+b.data.moduleId+" .group_img").show(0).delay(500).animate({top:0,left:0,height:20},300),0!==parseInt(b.data.module.getElementsByClassName("group_nb")[0].innerText)&&a("#module-"+b.data.moduleId+" .group_nb").delay(600).show(300),a("#module-"+b.data.moduleId+" .actions").delay(600).show(300))},1e3)}var t=d,u=g,v=i,w=j,x=h,y={NULL:0,EASY:1,BETTER:2,HARD:3},z={},A={},B={},C={},D={};x.forEach(function(a){var b=parseInt(a);z[b]=!1,A[b]=null,B[b]=null,C[b]=null,D[b]=null}),a(".activity").not(".label").mouseover(function(){a(this).css({background:"linear-gradient(to right, #f4f4f4, #f4f4f4, white)","border-radius":"5px"})}).mouseout(function(){a(this).css({background:""})}),x.forEach(function(b){var c=parseInt(b);if(null!==document.getElementById("module-"+c)){var d=l(c),e='<div class="block_point_view reactions"><!-- EASY ! --><span class="tooltipreaction"><img src="'+u.easy+'" alt=" " class="easy"/><span class="tooltiptextreaction easy_txt">'+u.easytxt+'</span></span><span class="easy_nb">'+d.typeone+'</span><!-- I\'M GETTING BETTER --><span class="tooltipreaction"><img src="'+u.better+'" alt=" " class="better"/><span class="tooltiptextreaction better_txt">'+u.bettertxt+'</span></span><span class="better_nb">'+d.typetwo+'</span><!-- SO HARD... --><span class="tooltipreaction"><img src="'+u.hard+'" alt=" " class="hard"/><span class="tooltiptextreaction hard_txt">'+u.hardtxt+'</span></span><span class="hard_nb">'+d.typethree+'</span></div><!-- GROUP --><div class="block_point_view group"><img src="" alt=" " class="group_img"/><span class="group_nb">'+d.total+"</span></div>";switch(a("#module-"+c+" .activityinstance").append(e),parseInt(d.uservote)){case 1:A[c]=y.EASY,a("#module-"+c+" .easy_nb").css({"font-weight":"bold",color:"#5585B6"});break;case 2:A[c]=y.BETTER,a("#module-"+c+" .better_nb").css({"font-weight":"bold",color:"#5585B6"});break;case 3:A[c]=y.HARD,a("#module-"+c+" .hard_nb").css({"font-weight":"bold",color:"#5585B6"});break;default:A[c]=y.NULL}var f=document.getElementById("module-"+c);0===parseInt(f.getElementsByClassName("group_nb")[0].innerText)&&a("#module-"+c+" .group_nb").hide(),k(f,c),a("#module-"+c+" .group_img").mouseover({module:f,moduleId:c},m).click({module:f,moduleId:c},m).mouseout({moduleId:c},n),a("#module-"+c+" .easy").mouseover({module:f,moduleId:c,reactionName:"easy",className:"easy_txt",leftReaction:-30},o).mouseout({module:f,moduleId:c,leftReaction:-20,reactionName:"easy"},p).click({module:f,moduleId:c,reactionName:"easy",reactionSelect:y.EASY},q),a("#module-"+c+" .better").mouseover({module:f,moduleId:c,reactionName:"better",className:"better_txt",leftReaction:15},o).mouseout({module:f,moduleId:c,leftReaction:25,reactionName:"better"},p).click({module:f,moduleId:c,reactionName:"better",reactionSelect:y.BETTER},q);var g=a("#module-"+c+" .hard"),h=parseInt(g.css("left").slice(0,-2),10);g.mouseover({module:f,moduleId:c,reactionName:"hard",className:"hard_txt",leftReaction:h-20},o).mouseout({module:f,moduleId:c,leftReaction:h-10,reactionName:"hard"},p).click({module:f,moduleId:c,reactionName:"hard",reactionSelect:y.HARD},q),a("#module-"+c+" .reactions").mouseover({moduleId:c},r).mouseout({module:f,moduleId:c},s)}}),v.forEach(function(b){if("0"!==b.difficultyLevel){var c;switch(parseInt(b.difficultyLevel)){case 1:c="green";break;case 2:c="blue";break;case 3:c="red";break;case 4:c="black"}var d='<div class="block_point_view track '+c+'track"></div>';a("#module-"+b.id+" .activityinstance a").prepend(d)}else{var e='<span class="block_point_view track"></span>';a("#module-"+b.id+" .activityinstance a").prepend(e)}}),a("#region-main > .card").css({"overflow-x":"unset"}),a(".greentrack").css({"background-color":w.greentrack}),a(".bluetrack").css({"background-color":w.bluetrack}),a(".redtrack").css({"background-color":w.redtrack}),a(".blacktrack").css({"background-color":w.blacktrack}),a(".block_point_view #menu_point_view_img").mouseover(function(){a(this).css({"-webkit-filter":"invert(100%)","-moz-filter":"invert(100%)","-o-filter":"invert(100%)","-ms-filter":"invert(100%)"})}).mouseout(function(){a(this).css({"-webkit-filter":"invert(0%)","-moz-filter":"invert(0%)","-o-filter":"invert(0%)","-ms-filter":"invert(0%)"})})})})}}});